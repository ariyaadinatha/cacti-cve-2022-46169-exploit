FROM alpine:latest

# Install required packages
RUN apk update && \
    apk add --no-cache apache2 php7 php7-apache2 php7-pear php7-gd php7-mysqli php7-session php7-snmp rrdtool net-snmp net-snmp-utils curl && \
    rm -rf /var/cache/apk/*

# Download and extract Cacti 1.2.22
RUN curl -L https://github.com/Cacti/cacti/archive/refs/tags/release/1.2.22.tar.gz | tar zxvf -

# Move Cacti to Apache web directory
RUN mv cacti-release-1.2.22 /var/www/localhost/htdocs/cacti

# Set permissions on Cacti directory
RUN chown -R apache:apache /var/www/localhost/htdocs/cacti && \
    chmod -R 755 /var/www/localhost/htdocs/cacti

# Configure Apache to serve Cacti
COPY cacti.conf /etc/apache2/conf.d/

# Start Apache web server
CMD ["httpd", "-D", "FOREGROUND"]
